<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
		<title>Smoothed D3.js Radar Chart</title>

		<!-- Google fonts -->
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300" rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
	
		<!--DataTable -->
		<link rel="stylesheet" type="text/css" href="https://www.jqueryscript.net/demo/DataTables-Jquery-Table-Plugin/media/css/jquery.dataTables.css"/>
		
		<!-- D3.js -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
		
		
		<style>
			* {
				box-sizing: border-box;
			}
			body {
				width: 1700px;
				margin: 0;
				font-family: 'Open Sans', sans-serif;
				font-size: 11px;
				font-weight: 300;
				fill: #242424;
				text-align: center;
				cursor: default;
				/* background: linear-gradient(to right, rgba(254, 177, 68, 0.5), rgba(253, 253, 151,0.5), rgba(158, 224, 158, 0.5), rgba(158, 193, 207, 0.5),  rgba(204, 153, 201, 0.5)); */
			}
			
			div.left {
				width: 800px;
				height: 540px;
				float: left;
				/* border: 1px solid black;	 */
			}

			div.right {
				width: 500px;
				height: 540px;
				float: left;
				text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
				/* border: 1px solid black; */
			}

			#annotation {
				padding-left: 20px;
				padding-right: 20px;
				width: 400px;
				float: left;
				height: 540px;
				/* border: 1px solid black; */
				/* background-color: #333333; */
				line-height: 540px;
			}
			

			#textbox {
				display: inline-block;
				vertical-align: middle;
				line-height: normal;
			}

			.header {
				font-style: italic;
			}
			#annotation h1 {
				font-size: 30px;
			}

			#annotation p {
				text-align: left;
				font-size: 13px;
				font-weight: 500;
			}
			
			.legend {
				font-family: 'Raleway', sans-serif;
				fill: #333333;
			}
			
			.tooltip {
				fill: #333333;
			}
			
			
			.bubbles {
			  stroke-width: 1px;
			  stroke: white;
			}
			.bubbles:hover {
			  stroke: black;
			}
			
			table.dataTable thead .sorting:after,
			table.dataTable thead .sorting:before,
			table.dataTable thead .sorting_asc:after,
			table.dataTable thead .sorting_asc:before,
			table.dataTable thead .sorting_asc_disabled:after,
			table.dataTable thead .sorting_asc_disabled:before,
			table.dataTable thead .sorting_desc:after,
			table.dataTable thead .sorting_desc:before,
			table.dataTable thead .sorting_desc_disabled:after,
			table.dataTable thead .sorting_desc_disabled:before {
				bottom: .5em;
			}
			
		</style>
	
	</head>
	<body>
		<div id = "annotation"></div>
		<div id="my_dataviz" class="left"></div>
		
		<div class="radarChart right"></div>
		
		
		<table id="example" class="display" style="width: 100%">
			<thead>
				<tr>
					<th>Artists</th>
					<th>Song Name</th>
					<th>Year</th>
					<th>Peak Position (Rank)</th>
					<th>Weeks On Chart</th>
					<th>Popularity</th>
					<th>Acousticness</th>
					<th>Danceability</th>
					<th>Energy</th>
					<th>Key</th>
					<th>Tempo</th>
					<th>Valence</th>
					<th>Cluster</th>
				</tr>
			</thead>

			<tbody>
<tr class="cluster_3"><td>Maroon 5</td><td>Girls Like You</td><td>2018</td><td>1</td><td>52</td><td>64</td><td>57</td><td>57</td><td>43</td><td>0</td><td>7</td><td>0</td><td>3</td></tr>
<tr class="cluster_0"><td>Travis Scott</td><td>Sicko Mode</td><td>2018</td><td>1</td><td>47</td><td>92</td><td>1</td><td>83</td><td>72</td><td>73</td><td>66</td><td>0</td><td>0</td></tr>
<tr class="cluster_2"><td>XXXTENTACION</td><td>Sad!</td><td>2018</td><td>1</td><td>38</td><td>87</td><td>26</td><td>72</td><td>59</td><td>73</td><td>16</td><td>0</td><td>2</td></tr>
<tr class="cluster_1"><td>Ariana Grande</td><td>Thank U, Next</td><td>2018</td><td>1</td><td>28</td><td>85</td><td>23</td><td>69</td><td>64</td><td>9</td><td>36</td><td>0</td><td>1</td></tr>
<tr class="cluster_4"><td>Childish Gambino</td><td>This Is America</td><td>2018</td><td>1</td><td>17</td><td>83</td><td>12</td><td>85</td><td>43</td><td>45</td><td>44</td><td>100</td><td>4</td></tr>
<tr class="cluster_2"><td>Juice WRLD</td><td>Lucid Dreams</td><td>2018</td><td>2</td><td>46</td><td>89</td><td>36</td><td>46</td><td>54</td><td>55</td><td>22</td><td>0</td><td>2</td></tr>
<tr class="cluster_2"><td>Post Malone</td><td>Better Now</td><td>2018</td><td>3</td><td>52</td><td>85</td><td>34</td><td>65</td><td>56</td><td>91</td><td>59</td><td>0</td><td>2</td></tr>
<tr class="cluster_4"><td>Bruno Mars, Cardi B</td><td>Finesse</td><td>2018</td><td>3</td><td>23</td><td>67</td><td>1</td><td>72</td><td>79</td><td>45</td><td>35</td><td>100</td><td>4</td></tr>
<tr class="cluster_1"><td>6ix9ine</td><td>FEFE</td><td>2018</td><td>3</td><td>20</td><td>81</td><td>9</td><td>94</td><td>35</td><td>9</td><td>48</td><td>0</td><td>1</td></tr>
<tr class="cluster_3"><td>The Weeknd</td><td>Call Out My Name</td><td>2018</td><td>4</td><td>18</td><td>82</td><td>17</td><td>40</td><td>57</td><td>9</td><td>53</td><td>0</td><td>3</td></tr>
<tr class="cluster_2"><td>Zedd, Maren Morris, Grey</td><td>The Middle</td><td>2018</td><td>5</td><td>40</td><td>82</td><td>17</td><td>73</td><td>64</td><td>64</td><td>36</td><td>0</td><td>2</td></tr>
<tr class="cluster_1"><td>Halsey</td><td>Bad At Love</td><td>2018</td><td>5</td><td>33</td><td>75</td><td>6</td><td>64</td><td>74</td><td>0</td><td>43</td><td>100</td><td>1</td></tr>
<tr class="cluster_1"><td>Camila Cabello</td><td>Never Be The Same</td><td>2018</td><td>6</td><td>37</td><td>64</td><td>15</td><td>61</td><td>69</td><td>0</td><td>50</td><td>0</td><td>1</td></tr>
<tr class="cluster_4"><td>Lil Baby, Drake</td><td>Yes Indeed</td><td>2018</td><td>6</td><td>29</td><td>80</td><td>4</td><td>97</td><td>31</td><td>45</td><td>44</td><td>100</td><td>4</td></tr>
<tr class="cluster_3"><td>Sheck Wes</td><td>Mo Bamba</td><td>2018</td><td>6</td><td>28</td><td>80</td><td>20</td><td>71</td><td>61</td><td>36</td><td>60</td><td>0</td><td>3</td></tr>
<tr class="cluster_2"><td>J. Cole</td><td>ATM</td><td>2018</td><td>6</td><td>5</td><td>68</td><td>12</td><td>69</td><td>47</td><td>73</td><td>20</td><td>0</td><td>2</td></tr>
<tr class="cluster_0"><td>5 Seconds Of Summer</td><td>Youngblood</td><td>2018</td><td>7</td><td>48</td><td>83</td><td>2</td><td>55</td><td>85</td><td>64</td><td>44</td><td>0</td><td>0</td></tr>
<tr class="cluster_1"><td>Lil Wayne</td><td>Uproar</td><td>2018</td><td>7</td><td>20</td><td>71</td><td>6</td><td>72</td><td>87</td><td>9</td><td>31</td><td>100</td><td>1</td></tr>
<tr class="cluster_2"><td>Drake</td><td>I'm Upset</td><td>2018</td><td>7</td><td>16</td><td>72</td><td>29</td><td>90</td><td>56</td><td>100</td><td>62</td><td>0</td><td>2</td></tr>
<tr class="cluster_1"><td>Ariana Grande</td><td>God Is A Woman</td><td>2018</td><td>8</td><td>22</td><td>80</td><td>2</td><td>56</td><td>64</td><td>9</td><td>59</td><td>0</td><td>1</td></tr>
<tr class="cluster_0"><td>Travis Scott</td><td>Stargazing</td><td>2018</td><td>8</td><td>8</td><td>84</td><td>1</td><td>43</td><td>78</td><td>73</td><td>62</td><td>0</td><td>0</td></tr>
<tr class="cluster_1"><td>Migos</td><td>Walk It Talk It</td><td>2018</td><td>10</td><td>22</td><td>77</td><td>9</td><td>91</td><td>61</td><td>18</td><td>60</td><td>0</td><td>1</td></tr>
<tr class="cluster_0"><td>Andy Williams</td><td>It's The Most Wonderful Time Of The Year</td><td>2018</td><td>10</td><td>10</td><td>51</td><td>78</td><td>15</td><td>58</td><td>64</td><td>95</td><td>100</td><td>0</td></tr>

			</tbody>
		</table>
		
        <!-- <script src="radarChart.js"></script>	 -->
        <script>
			// get background from Question.html
			// document.body.style = localStorage.getItem("backgroundstyle");

			
			
			var color_cluster0 = "#f48f01"
			var color_cluster1 = "#a88d32"
			var color_cluster2 = "#00f000"
			var color_cluster3 = "#2eafff"
			var color_cluster4 = "#ff66f5"
			var cluster_colors = [color_cluster0,color_cluster1,color_cluster2,color_cluster3,color_cluster4];

			
            function RadarChart(id, data, options) {
	var cfg = {
	 w: 600,				//Width of the circle
	 h: 600,				//Height of the circle
	 margin: {top: 20, right: 20, bottom: 20, left: 20}, //The margins of the SVG
	 levels: 3,				//How many levels or inner circles should there be drawn
	 maxValue: 0, 			//What is the value that the biggest circle will represent
	 labelFactor: 1.25, 	//How much farther than the radius of the outer circle should the labels be placed
	 wrapWidth: 60, 		//The number of pixels after which a label needs to be given a new line
	 opacityArea: 0.07, 	//The opacity of the area of the blob
	 dotRadius: 1.5, 			//The size of the colored circles of each blob
	 opacityCircles: 0.1, 	//The opacity of the circles of each blob
	 strokeWidth: 2, 		//The width of the stroke around each blob
	 roundStrokes: false,	//If true the area and stroke will follow a round path (cardinal-closed)
	 color: d3.scale.category10()	//Color function
	};
	
	//Put all of the options into a variable called cfg
	if('undefined' !== typeof options){
	  for(var i in options){
		if('undefined' !== typeof options[i]){ cfg[i] = options[i] }
	  }//for i
	}//if
	
	//If the supplied maxValue is smaller than the actual one, replace by the max in the data
	var maxValue = Math.max(cfg.maxValue, d3.max(data, function(i){return d3.max(i.map(function(o){return o.value;}))}));
		
	var allAxis = (data[0].map(function(i, j){return i.axis})),	//Names of each axis
		total = allAxis.length,					//The number of different axes
		radius = Math.min(cfg.w/2, cfg.h/2), 	//Radius of the outermost circle
		Format = d3.format('%'),			 	//Percentage formatting
		angleSlice = Math.PI * 2 / total;		//The width in radians of each "slice"
	
	//Scale for the radius
	var rScale = d3.scale.linear()
		.range([0, radius])
		.domain([0, maxValue]);
		
	/////////////////////////////////////////////////////////
	//////////// Create the container SVG and g /////////////
	/////////////////////////////////////////////////////////

	//Remove whatever chart with the same id/class was present before
	d3.select(id).select("svg").remove();
	
	//Initiate the radar chart SVG
	var svg = d3.select(id).append("svg")
			.attr("width",  cfg.w + cfg.margin.left + cfg.margin.right)
			.attr("height", cfg.h + cfg.margin.top + cfg.margin.bottom)
			.attr("class", "radar"+id);
	//Append a g element		
	var g = svg.append("g")
			.attr("transform", "translate(" + (cfg.w/2 + cfg.margin.left) + "," + (cfg.h/2 + cfg.margin.top) + ")");
	
	/////////////////////////////////////////////////////////
	////////// Glow filter for some extra pizzazz ///////////
	/////////////////////////////////////////////////////////
	
	//Filter for the outside glow
	var filter = g.append('defs').append('filter').attr('id','glow'),
		feGaussianBlur = filter.append('feGaussianBlur').attr('stdDeviation','2.5').attr('result','coloredBlur'),
		feMerge = filter.append('feMerge'),
		feMergeNode_1 = feMerge.append('feMergeNode').attr('in','coloredBlur'),
		feMergeNode_2 = feMerge.append('feMergeNode').attr('in','SourceGraphic');

	/////////////////////////////////////////////////////////
	/////////////// Draw the Circular grid //////////////////
	/////////////////////////////////////////////////////////
	
	//Wrapper for the grid & axes
	var axisGrid = g.append("g").attr("class", "axisWrapper");
	
	//Draw the background circles
	axisGrid.selectAll(".levels")
	   .data(d3.range(1,(cfg.levels+1)).reverse())
	   .enter()
		.append("circle")
		.attr("class", "gridCircle")
		.attr("r", function(d, i){return radius/cfg.levels*d;})
		.style("fill", "#CDCDCD")
		.style("stroke", "#CDCDCD")
		.style("fill-opacity", cfg.opacityCircles)
		.style("filter" , "url(#glow)");

	//Text indicating at what % each level is
	axisGrid.selectAll(".axisLabel")
	   .data(d3.range(1,(cfg.levels+1)).reverse())
	   .enter().append("text")
	   .attr("class", "axisLabel")
	   .attr("x", 4)
	   .attr("y", function(d){return -d*radius/cfg.levels;})
	   .attr("dy", "0.4em")
	   .style("font-size", "10px")
	   .attr("fill", "#737373")
	   .text(function(d,i) { return Format(maxValue * d/cfg.levels); });

	/////////////////////////////////////////////////////////
	//////////////////// Draw the axes //////////////////////
	/////////////////////////////////////////////////////////
	
	//Create the straight lines radiating outward from the center
	var axis = axisGrid.selectAll(".axis")
		.data(allAxis)
		.enter()
		.append("g")
		.attr("class", "axis");
	//Append the lines
	axis.append("line")
		.attr("x1", 0)
		.attr("y1", 0)
		.attr("x2", function(d, i){ return rScale(maxValue*1.1) * Math.cos(angleSlice*i - Math.PI/2); })
		.attr("y2", function(d, i){ return rScale(maxValue*1.1) * Math.sin(angleSlice*i - Math.PI/2); })
		.attr("class", "line")
		.style("stroke", "white")
		.style("stroke-width", "2px");

	//Append the labels at each axis
	axis.append("text")
		.attr("class", "legend")
		.style("font-size", "14px")
		.attr("text-anchor", "middle")
		.attr("dy", "0.35em")
		.attr("x", function(d, i){ return rScale(maxValue * cfg.labelFactor) * Math.cos(angleSlice*i - Math.PI/2); })
		.attr("y", function(d, i){ return rScale(maxValue * cfg.labelFactor) * Math.sin(angleSlice*i - Math.PI/2); })
		.text(function(d){return d})
		.call(wrap, cfg.wrapWidth);

	/////////////////////////////////////////////////////////
	///////////// Draw the radar chart blobs ////////////////
	/////////////////////////////////////////////////////////
	
	//The radial line function
	var radarLine = d3.svg.line.radial()
		.interpolate("linear-closed")
		.radius(function(d) { return rScale(d.value); })
		.angle(function(d,i) {	return i*angleSlice; });
		
	if(cfg.roundStrokes) {
		radarLine.interpolate("cardinal-closed");
	}
				
	//Create a wrapper for the blobs	
	var blobWrapper = g.selectAll(".radarWrapper")
		.data(data)
		.enter().append("g")
		.attr("class", "radarWrapper");
	
	//Append the backgrounds	
	blobWrapper
		.append("path")
		.attr("class", function (d,i) { return "radarArea cluster_"+i; })
		.attr("d", function(d,i) { return radarLine(d); })
		.style("fill", function(d,i) { return cluster_colors[i]; })
		.style("fill-opacity", cfg.opacityArea)
		.on('mouseover', function (d,i){
			//Dim all blobs
			d3.selectAll(".radarArea")
				.transition().duration(50)
				.style("fill-opacity", 0.07); 
			//Bring back the hovered over blob
			d3.select(this)
				.transition().duration(50)
				.style("fill-opacity", 0.5);
			
			d3.select(blobStrokes[0][i])
				.style("stroke-width", 3);
			
			d3.select(blobCircles[i][0])
				.attr("r", 4);
			d3.select(blobCircles[i][1])
				.attr("r", 4);
			d3.select(blobCircles[i][2])
				.attr("r", 4);
			d3.select(blobCircles[i][3])
				.attr("r", 4);
			d3.select(blobCircles[i][4])
				.attr("r", 4);
			d3.select(blobCircles[i][5])
				.attr("r", 4);
		})
		.on('mouseout', function(){
			//Bring back all blobs
			d3.selectAll(".radarArea")
				.transition().duration(50)
				.style("fill-opacity", cfg.opacityArea);

			// dot size go to original
			d3.selectAll(".radarCircle")
				.attr("r", cfg.dotRadius);
			d3.selectAll(".radarStroke")
				.style("stroke-width", cfg.strokeWidth + "px");
		});
		
	// Create the outlines	
	var blobStrokes = blobWrapper.append("path")
		.attr("class", "radarStroke")
		.attr("d", function(d,i) { return radarLine(d); })
		.style("stroke-width", cfg.strokeWidth + "px")
		.style("stroke", function(d,i) { return cluster_colors[i]; })
		.style("fill", "none")
		.style("filter" , "url(#glow)");		
	
	//Append the circles
	var blobCircles = blobWrapper.selectAll(".radarCircle")
		.data(function(d,i) { return d; })
		.enter().append("circle")
		.attr("class", "radarCircle")
		.attr("r", cfg.dotRadius)
		.attr("cx", function(d,i){ return rScale(d.value) * Math.cos(angleSlice*i - Math.PI/2); })
		.attr("cy", function(d,i){ return rScale(d.value) * Math.sin(angleSlice*i - Math.PI/2); })
		.style("fill", function(d,i,j) { return cluster_colors[j]; })
		.style("fill-opacity", 0.5);

	/////////////////////////////////////////////////////////
	//////// Append invisible circles for tooltip ///////////
	/////////////////////////////////////////////////////////
	
	//Wrapper for the invisible circles on top
	var blobCircleWrapper = g.selectAll(".radarCircleWrapper")
		.data(data)
		.enter().append("g")
		.attr("class", "radarCircleWrapper");
		
	//Append a set of invisible circles on top for the mouseover pop-up
	blobCircleWrapper.selectAll(".radarInvisibleCircle")
		.data(function(d,i) { return d; })
		.enter().append("circle")
		.attr("class", "radarInvisibleCircle")
		.attr("r", cfg.dotRadius*3)
		.attr("cx", function(d,i){ return rScale(d.value) * Math.cos(angleSlice*i - Math.PI/2); })
		.attr("cy", function(d,i){ return rScale(d.value) * Math.sin(angleSlice*i - Math.PI/2); })
		.style("fill", "none")
		.style("pointer-events", "all")
		.on("mouseover", function(d,i) {
			newX =  parseFloat(d3.select(this).attr('cx')) - 10;
			newY =  parseFloat(d3.select(this).attr('cy')) - 10;
					
			tooltip
				.attr('x', newX)
				.attr('y', newY)
				.text(Format(d.value))
				.transition().duration(100)
				.style('opacity', 1);
		})
		.on("mouseout", function(){
			tooltip.transition().duration(100)
				.style("opacity", 0);
		});
		
	//Set up the small tooltip for when you hover over a circle
	var tooltip = g.append("text")
		.attr("class", "tooltip")
		.style("opacity", 0);
	
	/////////////////////////////////////////////////////////
	/////////////////// Helper Function /////////////////////
	/////////////////////////////////////////////////////////

	//Taken from http://bl.ocks.org/mbostock/7555321
	//Wraps SVG text	
	function wrap(text, width) {
	  text.each(function() {
		var text = d3.select(this),
			words = text.text().split(/\s+/).reverse(),
			word,
			line = [],
			lineNumber = 0,
			lineHeight = 1.4, // ems
			y = text.attr("y"),
			x = text.attr("x"),
			dy = parseFloat(text.attr("dy")),
			tspan = text.text(null).append("tspan").attr("x", x).attr("y", y).attr("dy", dy + "em");
			
		while (word = words.pop()) {
		  line.push(word);
		  tspan.text(line.join(" "));
		  if (tspan.node().getComputedTextLength() > width) {
			line.pop();
			tspan.text(line.join(" "));
			line = [word];
			tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
		  }
		}
	  });
	}//wrap	
	
}//RadarChart

      
      /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */
      
			////////////////////////////////////////////////////////////// 
			//////////////////////// Set-Up ////////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var margin = {top: 100, right: 100, bottom: 100, left: 100},
				width = Math.min(500, window.innerWidth - 10) - margin.left - margin.right,
				height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);
					
			////////////////////////////////////////////////////////////// 
			////////////////////////// Data ////////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var data = [
					  [//Cluster 0
						{axis:"Acousticness",value:0.071055294},
						{axis:"Danceability",value:0.453618826},
						{axis:"Energy",value:0.761991185},
						{axis:"Key",value:0.684936436},
						{axis:"Tempo",value:0.615763737},
						{axis:"Valence",value:0.40379325}			
					  ],[//Cluster 1
						{axis:"Acousticness",value:0.087702953},
						{axis:"Danceability",value:0.598848328},
						{axis:"Energy",value:0.733740494},
						{axis:"Key",value:0.132974482},
						{axis:"Tempo",value:0.465931121},
						{axis:"Valence",value:0.539022965}
					  ],[//Cluster 2
						{axis:"Acousticness",value:0.249717763},
						{axis:"Danceability",value:0.61390192},
						{axis:"Energy",value:0.553778786},
						{axis:"Key",value:0.806488118},
						{axis:"Tempo",value:0.364874871},
						{axis:"Valence",value:0.360494282}
					  ],[//Cluster 3
						{axis:"Acousticness",value:0.498260745},
						{axis:"Danceability",value:0.532139439},
						{axis:"Energy",value:0.42701903},
						{axis:"Key",value:0.235011564},
						{axis:"Tempo",value:0.41620033},
						{axis:"Valence",value:0.284172134}
					  ],[//Cluster 4
						{axis:"Acousticness",value:0.118170506},
						{axis:"Danceability",value:0.674216718},
						{axis:"Energy",value:0.764907637},
						{axis:"Key",value:0.676291214},
						{axis:"Tempo",value:0.407292043},
						{axis:"Valence",value:0.750732841}
					  ]
			    	];
			////////////////////////////////////////////////////////////// 
			//////////////////// Draw the Chart ////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var color = d3.scale.ordinal()
				.range(cluster_colors);
				
			var radarChartOptions = {
			  w: width,
			  h: height,
			  margin: margin,
			  maxValue: 0.5,
			  levels: 5,
			  roundStrokes: true,
			  color: color
			};
			//Call function to draw the Radar chart
			RadarChart(".radarChart", data, radarChartOptions);
		</script>

		<script src="https://www.jqueryscript.net/demo/DataTables-Jquery-Table-Plugin/media/js/jquery.js"></script>
		<script type="text/javascript" src="https://www.jqueryscript.net/demo/DataTables-Jquery-Table-Plugin/media/js/jquery.dataTables.js"></script>
		<script>
			var table = $('#example').DataTable();
		</script>

		
		
		<script src="https://d3js.org/d3.v4.js"></script>
		<script>	
			/////////////////////////////////////////////////////
			/////////////////////////////////////////////////////
			///////////////////Bubble Chart/////////////////////
			/////////////////////////////////////////////////////
			/////////////////////////////////////////////////////
			// set the dimensions and margins of the graph
			var margin = {top: 90, right: 60, bottom: 30, left: 50},
				width = 900 - margin.left - margin.right,
				height = 470 - margin.top - margin.bottom;

			// append the svg object to the body of the page
			var svg = d3.select("#my_dataviz")
			  .append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			  .append("g")
				.attr("transform",
					  "translate(" + margin.left + "," + margin.top + ")");

			//Read the data
			d3.csv("data_for_bubble.csv", function(data) {

			  // Add X axis
			  var x = d3.scaleLinear()
				.domain([1998, 2020])
				.range([ 0, width-margin.right*4 ]);
			  var xAxis = d3.axisBottom().scale(x).tickFormat(d3.format("d"));
			  svg.append("g")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

			  // Add Y axis
			  var y = d3.scaleLinear()
				.domain([10, 1])
				.range([height, 0]);
			  svg.append("g")
					.call(d3.axisLeft(y))
				.append("text")
				.attr("class", "axis-title")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end")
				.attr("fill", "#5D6971")
				.text("Peak position (Rank)");

			  // Add a scale for bubble size
			  var z = d3.scaleLinear()
				.domain([0, 200])
				.range([ 0, 50]);

			  // -1- Create a tooltip div that is hidden by default:
			  var tooltip = d3.select("#my_dataviz")
				.append("div")
				  .style("opacity", 0)
				  .attr("class", "tooltip")
				  .style("background-color", "black")
				  .style("border-radius", "5px")
				  .style("padding", "10px")
				  .style("color", "white")

			  // -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
			  var showTooltip = function(d) {
				tooltip
				  .transition()
				  .duration(200)
				tooltip
				  .style("opacity", 1)
				  .html('"' + d.Name + '" ' + 'by ' + d.Artists + ' (' + d.Year + ') <br>Peak Position: ' + d.PeakPosition + ' ('+d.WeeksOnChart+' weeks on chart)')
				  .style("left", (d3.mouse(this)[0]+30) + "px")
				  .style("top", (d3.mouse(this)[1]+30) + "px")
			  }
			  var moveTooltip = function(d) {
				tooltip
				  .style("left", (d3.mouse(this)[0]+30) + "px")
				  .style("top", (d3.mouse(this)[1]+30) + "px")
			  }
			  var hideTooltip = function(d) {
				tooltip
				  .transition()
				  .duration(200)
				  .style("opacity", 0)
			  }

			  // Add dots
			  svg.append('g')
				.selectAll("dot")
				.data(data)
				.enter()
				.append("circle")
				  .attr("class", function (d) { return "bubbles cluster_"+d.cluster; })
				  .attr("cx", function (d) { return x(d.Year); } )
				  .attr("cy", function (d) { return y(d.PeakPosition); } )
				  .attr("r", function (d) { return z(d.WeeksOnChart); } )
				  .style("fill", function (d) { return cluster_colors[d.cluster]; } )
				// -3- Trigger the functions
				.on("mouseover", showTooltip )
				.on("mousemove", moveTooltip )
				.on("mouseleave", hideTooltip )

			  /* Legends of bubbles START */
			  // The scale you use for bubble size
			  var size = d3.scaleSqrt()
				.domain([0, 100])  // What's in the data, let's say it is percentage
				.range([1, 100])  // Size in pixel
			  
			  // Add legend: circles
			  var valuesToShow = [1, 2, 3]
			  var xCircle = 590
			  var xLabel = 620
			  var yCircle = 330
			  svg
				.selectAll("legend")
				.data(valuesToShow)
				.enter()
				.append("circle")
				  .attr("cx", xCircle)
				  .attr("cy", function(d){ return yCircle - size(d) } )
				  .attr("r", function(d){ return size(d) })
				  .style("fill", "none")
				  .attr("stroke", "black")
			  
			  // Add legend: segments
			  svg
				.selectAll("legend")
				.data(valuesToShow)
				.enter()
				.append("line")
				  .attr('x1', function(d){ return xCircle + size(d)*0 } )
				  .attr('x2', xLabel)
				  .attr('y1', function(d){ return yCircle - size(d)*2 } )
				  .attr('y2', function(d){ return yCircle - size(d)*2 } )
				  .attr('stroke', 'black')
				  .style('stroke-dasharray', ('2,2'))
			  
			  // Add legend: labels
			  svg
				.selectAll("legend")
				.data(valuesToShow)
				.enter()
				.append("text")
				  .attr('x', xLabel)
				  .attr('y', function(d){ return yCircle - size(d)*2 } )
				  .text( function(d){ return 60+15*(d-1)+' Weeks on chart' } )
				  .style("font-size", 8)
				  .attr('alignment-baseline', 'middle')
			  /* Legends of bubbles END */
			  
			  // Handmade legend
			  svg.append("circle").attr("class","cluster-btn").attr("id","cluster_0").attr("cx",620).attr("cy",100).attr("r", 6).style("fill", color_cluster0)
			  svg.append("text").attr("class","cluster-btn").attr("id","cluster_0").attr("x", 640).attr("y", 100).text("Cluster 0").style("font-size", "15px").attr("alignment-baseline","middle")
			  svg.append("circle").attr("class","cluster-btn").attr("id","cluster_1").attr("cx",620).attr("cy",130).attr("r", 6).style("fill", color_cluster1)
			  svg.append("text").attr("class","cluster-btn").attr("id","cluster_1").attr("x", 640).attr("y", 130).text("Cluster 1").style("font-size", "15px").attr("alignment-baseline","middle")
			  svg.append("circle").attr("class","cluster-btn").attr("id","cluster_2").attr("cx",620).attr("cy",160).attr("r", 6).style("fill", color_cluster2)
			  svg.append("text").attr("class","cluster-btn").attr("id","cluster_2").attr("x", 640).attr("y", 160).text("Cluster 2").style("font-size", "15px").attr("alignment-baseline","middle")
			  svg.append("circle").attr("class","cluster-btn").attr("id","cluster_3").attr("cx",620).attr("cy",190).attr("r", 6).style("fill", color_cluster3)
			  svg.append("text").attr("class","cluster-btn").attr("id","cluster_3").attr("x", 640).attr("y", 190).text("Cluster 3").style("font-size", "15px").attr("alignment-baseline","middle")
			  svg.append("circle").attr("class","cluster-btn").attr("id","cluster_4").attr("cx",620).attr("cy",220).attr("r", 6).style("fill", color_cluster4)
			  svg.append("text").attr("class","cluster-btn").attr("id","cluster_4").attr("x", 640).attr("y", 220).text("Cluster 4").style("font-size", "15px").attr("alignment-baseline","middle")

			  /* cluster legend button */
			  var cluster_btns = document.getElementsByClassName("cluster-btn")
			  for (var i=0; i < cluster_btns.length; i++) {
				cluster_btns[i].onclick = function(){
					onchange_cluster(d3.select(this).property('id'));
				}
			  };
			  function onchange_cluster(clicked_id) {
					//bubble chart
					d3.selectAll("circle.bubbles").style('stroke', 'white')
					d3.selectAll("circle.bubbles."+clicked_id).transition().duration(100).style('stroke', 'black')
					
					//radarArea
					//Dim all blobs
					d3.selectAll(".radarArea").transition().duration(50).style("fill-opacity", 0.07); 
					//Bring back the hovered over blob
					d3.select(".radarArea."+clicked_id).transition().duration(50).style("fill-opacity", 0.5);
					
					//table
					var num = clicked_id.substring(8, 9)
					table.column(12).search(num).draw();
				}
				
				function hide_or_show_cluster(clicked_id) {
					if (d3.selectAll("circle."+clicked_id).attr('opacity') == null) {
						d3.selectAll("circle."+clicked_id).transition().duration(100).style('opacity', 0)
						d3.selectAll("circle."+clicked_id).attr('opacity', 0)
					} else {
						d3.selectAll("circle."+clicked_id).transition().duration(100).style('opacity', null)
						d3.selectAll("circle."+clicked_id).attr('opacity', null)
					}
				}
				
			  /* Forced click */
			  hide_or_show_cluster('cluster_0')
			  hide_or_show_cluster('cluster_1')
			  hide_or_show_cluster('cluster_2')
			  hide_or_show_cluster('cluster_3')
			  hide_or_show_cluster('cluster_4')
			  
			  /* Animation */
			  setTimeout(function() {
				  hide_or_show_cluster('cluster_0')
			  }, 1000);
			  setTimeout(function() {
				  hide_or_show_cluster('cluster_1')
			  }, 2000);
			  setTimeout(function() {
				  hide_or_show_cluster('cluster_2')
			  }, 3000);  
			  setTimeout(function() {
				  hide_or_show_cluster('cluster_3')
			  }, 4000);
			  setTimeout(function() {
				  hide_or_show_cluster('cluster_4')
			  }, 5000);
			  
			
			let annotations = ["<div id = 'textbox'><p class = 'header'>Your cluster is ...</p><h1>Karaoke Please</h1><p class = 'colorexp'>The color in the background each represented a cluster, and its opacity grew when you chose a song from it.</p> <p>Characterized by anthems made for climaxes at stadium gigs like Radioactive by Imagine Dragons and How You Remind Me by Nickelback, this cluster has the highest tempo and energy value out of all clusters. It is the lowest in acousticness and thus, a lot of the songs contain electronic sound sources.</p><p>You can view your cluster’s songs in the table below, and their mean feature values on the radar chart. Try hovering over the radar chart to see the shape of other clusters. The bubble chart explanation. Click the circles on the right to view other cluster results.</p><p><b>Fun Fact</b>: A lot of songs in this cluster had iconic humming lines; Viva La Vida by Coldplay, Pompeii by Bastille, Just The Way You Are by Bruno Mars, … . Sing Alongs are highly recommended 😊</p></div>", 
			"This is cluster 2",  
			"This is cluster 3",  
			"This is cluster 4",  
			"This is cluster 5"];

			function setAnnotation(clusterId) {
				document.getElementById("annotation").innerHTML = annotations[clusterId];
				onchange_cluster("cluster_" + String(clusterId));
			}

			
			// Set initial page with question result
			var initCluster = localStorage.getItem("clusterno");
			// console.log(initCluster);
			setAnnotation(initCluster);

			
			  })


		</script>
	</body>
</html>